<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content><link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel=stylesheet media=print type=text/css onload='this.media="all"'><title>Building a Basic Android Bot
</title><link rel=canonical href=https://davidhampgonsalves.com/building-a-basic-android-bot/><style>*{border:0;font:inherit;font-size:100%;vertical-align:baseline;margin:0;padding:0;color:#000;text-decoration-skip:ink}body{font-family:open sans,myriad pro,Myriad,sans-serif;font-size:17px;line-height:160%;color:#1d1313;max-width:700px;margin:auto}p{margin:20px 0}a img{border:none}img{margin:10px auto;max-width:100%;display:block}.left-justify{float:left}.right-justify{float:right}pre,code{font:12px Consolas,liberation mono,Menlo,Courier,monospace;background-color:#f7f7f7}code{font-size:12px;padding:4px}pre{margin-top:0;margin-bottom:16px;word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45}pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}pre code{display:inline;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}pre code::before,pre code::after{content:normal}em,q,em,dfn{font-style:italic}.sans,html .gist .gist-file .gist-meta{font-family:open sans,myriad pro,Myriad,sans-serif}.mono,pre,code,tt,p code,li code{font-family:Menlo,Monaco,andale mono,lucida console,courier new,monospace}.heading,.serif,h1,h2,h3{font-family:old standard tt,serif}strong{font-weight:600}q:before{content:"\201C"}q:after{content:"\201D"}del,s{text-decoration:line-through}blockquote{font-family:old standard tt,serif;text-align:center;padding:50px}blockquote p{display:inline-block;font-style:italic}blockquote:before,blockquote:after{font-family:old standard tt,serif;content:'\201C';font-size:35px;color:#403c3b}blockquote:after{content:'\201D'}hr{width:40%;height:1px;background:#403c3b;margin:25px auto}h1{font-size:35px}h2{font-size:28px}h3{font-size:22px;margin-top:18px}h1 a,h2 a,h3 a{text-decoration:none}h1,h2{margin-top:28px}#sub-header,.date{color:#403c3b;font-size:13px}#sub-header{margin:0 4px}#nav h1 a{font-size:35px;color:#1d1313;line-height:120%}.posts_listing a,#nav a{text-decoration:none}li{margin-left:20px}ul li{margin-left:5px}ul li{list-style-type:none}ul li:before{content:"\00BB \0020"}#nav ul li:before,.posts_listing li:before{content:'';margin-right:0}#content{text-align:left;width:100%;font-size:15px;padding:60px 0 80px}#content h1,#content h2{margin-bottom:5px}#content h2{font-size:25px}#content .entry-content{margin-top:15px}#content .date{margin-left:3px}#content h1{font-size:30px}.highlight{margin:10px 0}.posts_listing{margin:0 0 50px}.posts_listing li{margin:0 0 25px 15px}.posts_listing li a:hover,#nav a:hover{text-decoration:underline}#nav{text-align:center;position:static;margin-top:60px}#nav ul{display:table;margin:8px auto 0}#nav li{list-style-type:none;display:table-cell;font-size:15px;padding:0 20px}#links{display:flex;justify-content:space-between;margin:50px 0 0}#links :nth-child(1){margin-right:.5em}#links :nth-child(2){margin-left:.5em}#not-found{text-align:center}#not-found a{font-family:old standard tt,serif;font-size:200px;text-decoration:none;display:inline-block;padding-top:225px}@media(max-width:750px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:28px}#nav li{font-size:13px;padding:0 15px}#content{margin-top:0;padding-top:50px;font-size:14px}#content h1{font-size:25px}#content h2{font-size:22px}.posts_listing li div{font-size:12px}}@media(max-width:400px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:22px}#nav li{font-size:12px;padding:0 10px}#content{margin-top:0;padding-top:20px;font-size:12px}#content h1{font-size:20px}#content h2{font-size:18px}.posts_listing li div{font-size:12px}}@media(prefers-color-scheme:dark){*,#nav h1 a{color:#fdfdfd}body{background:#121212}pre,code{background-color:#262626}#sub-header,.date{color:#bababa}hr{background:#ebebeb}}</style></head><body><section id=nav><h1><a href=https://davidhampgonsalves.com/>David Hamp-Gonsalves</a></h1><ul><li><a href=//github.com/davidhampgonsalves>GitHub</a></li><li><a href=https://instagram.com/davidhampgonsalves/>Instagram</a></li><li><a href=https://davidhampgonsalves.com/projects>Projects</a></li><li><a href=https://davidhampgonsalves.com/resume>Resume</a></li></ul></section><section id=content><h1>Building a Basic Android Bot</h1><div id=sub-header>November 2013 Â· 2 minute read</div><div class=entry-content><p>Last week I started playing a new game on my phone called Castle Crash. I don&rsquo;t play often play video games but when I do, I play them obsesively until they are defeated. In this case you can&rsquo;t beat the game since you are playing against the internet so I decided to tap out and let my computer take over.</p><h2 id=monkeyrunner>MonkeyRunner</h2><p>Android has a great tool for writing simple automated tests on a device called MonkeyRunner. It uses Jython to let you write Python scripts that simulate user interactions and events on your device. <a href=http://developer.android.com/tools/help/monkeyrunner_concepts.html>MonkeyRunner</a> can be found in the tool directoy after you have installed the Android SDK.</p><h2 id=determine-apps-packageactivity>Determine Apps Package/Activity</h2><p>To determine an apps package/activity the easiest way is to download the .apk file, decompress it and take a look at the <a href=http://developer.android.com/guide/topics/manifest/manifest-intro.html>AndroidManifest.xml</a>. Alternatevly you can run the app on your device and watch the <a href=http://developer.android.com/tools/help/logcat.html>logs</a>.</p><h2 id=long-presses>Long Presses</h2><p>Long pressing is a pretty standard user interaction but MonkeyRunner doesn&rsquo;t really support it. It does however support .drag() which can be used for the same purpose.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>	device<span style=color:#f92672>.</span>drag((x,y), (x,y), pressTime)
</span></span></code></pre></div><h2 id=exiting-app>Exiting App</h2><p>Exiting the app is a good way to reset back to a known state and can be done between actions if the game structure allows.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>device<span style=color:#f92672>.</span>shell(<span style=color:#e6db74>&#39;am force-stop &#39;</span> <span style=color:#f92672>+</span> package)
</span></span></code></pre></div><h2 id=determine-interaction-coordinates>Determine Interaction Coordinates</h2><p>Since MonkeyRunner doesn&rsquo;t know anything about the app that is running it works solely with pixel coordinates. This means that you need to determine the location of all elements on the screen you want to interact with and there are a few ways of doign this. The most basic way is to determine the size in pixels of your device and then start estimating from there. This actually works quite well once you get the hang of it. A more accurate method is to enable ponter locations on your device(under developer options) and then walk through the flow keeping track of each required action.</p><h2 id=some-bot-code>Some Bot Code</h2><p>This code replenishes the four troop camps in Castle Crash and is a good example of simple interactions with the game.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>replenishTroops</span>(campNumber)\:
</span></span><span style=display:flex><span>	print <span style=color:#e6db74>&#39;replenishing troops&#39;</span>
</span></span><span style=display:flex><span>	campLocations <span style=color:#f92672>=</span> [(<span style=color:#ae81ff>320</span>, <span style=color:#ae81ff>400</span>), (<span style=color:#ae81ff>320</span>, <span style=color:#ae81ff>120</span>), (<span style=color:#ae81ff>590</span>, <span style=color:#ae81ff>80</span>), (<span style=color:#ae81ff>560</span>, <span style=color:#ae81ff>350</span>)][campNumber]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	touch(campLocations[<span style=color:#ae81ff>0</span>], campLocations[<span style=color:#ae81ff>1</span>]) <span style=color:#75715e>#select camp</span>
</span></span><span style=display:flex><span>	touch(<span style=color:#ae81ff>480</span>, <span style=color:#ae81ff>450</span>) <span style=color:#75715e>#press hire button</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	device<span style=color:#f92672>.</span>drag((<span style=color:#ae81ff>300</span>, <span style=color:#ae81ff>450</span>), (<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>450</span>)) <span style=color:#75715e>#scroll to archers</span>
</span></span><span style=display:flex><span>	time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>5</span>) <span style=color:#75715e>#wait for scroll to finish</span>
</span></span><span style=display:flex><span>	device<span style=color:#f92672>.</span>drag((<span style=color:#ae81ff>500</span>, <span style=color:#ae81ff>450</span>), (<span style=color:#ae81ff>501</span>, <span style=color:#ae81ff>451</span>), <span style=color:#ae81ff>5</span>) <span style=color:#75715e>#long press archers button</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	touch(<span style=color:#ae81ff>660</span>, <span style=color:#ae81ff>60</span>) <span style=color:#75715e>#close areana window</span>
</span></span><span style=display:flex><span>	touch(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>5</span>) <span style=color:#75715e>#deselect anything</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>touch</span>(x, y, delay<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)\:
</span></span><span style=display:flex><span>	print(<span style=color:#e6db74>&#39;touching &#39;</span> <span style=color:#f92672>+</span> str(x) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;, &#39;</span> <span style=color:#f92672>+</span> str(y))
</span></span><span style=display:flex><span>	device<span style=color:#f92672>.</span>touch(x, y, <span style=color:#e6db74>&#39;DOWN_AND_UP&#39;</span>)
</span></span><span style=display:flex><span>	time<span style=color:#f92672>.</span>sleep(delay)
</span></span></code></pre></div></div><div id=links><a href=https://davidhampgonsalves.com/compressing-json-into-a-brittle-lightweight-string/>&#171;&nbsp;Compressing JSON into a Brittle Lightweight String</a>
<a href=https://davidhampgonsalves.com/apps4halifax-crime-heatmaps/>Apps4Halifax Crime Heatmaps&nbsp;&#187;</a></div></section></body></html>