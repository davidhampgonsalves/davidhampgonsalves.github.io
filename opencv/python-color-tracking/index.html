<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content><link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel=stylesheet media=print type=text/css onload='this.media="all"'><title>OpenCV/Python Color Tracking</title><link rel=canonical href=https://davidhampgonsalves.com/opencv/python-color-tracking/><style>*{border:0;font:inherit;font-size:100%;vertical-align:baseline;margin:0;padding:0;color:#000;text-decoration-skip:ink}body{font-family:open sans,myriad pro,Myriad,sans-serif;font-size:17px;line-height:160%;color:#1d1313;max-width:700px;margin:auto}p{margin:20px 0}a img{border:none}img{margin:10px auto;max-width:100%;display:block}.left-justify{float:left}.right-justify{float:right}pre,code{font:12px Consolas,liberation mono,Menlo,Courier,monospace;background-color:#f7f7f7}code{font-size:12px;padding:4px}pre{margin-top:0;margin-bottom:16px;word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45}pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}pre code{display:inline;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}pre code::before,pre code::after{content:normal}em,q,em,dfn{font-style:italic}.sans,html .gist .gist-file .gist-meta{font-family:open sans,myriad pro,Myriad,sans-serif}.mono,pre,code,tt,p code,li code{font-family:Menlo,Monaco,andale mono,lucida console,courier new,monospace}.heading,.serif,h1,h2,h3{font-family:old standard tt,serif}strong{font-weight:600}q:before{content:"\201C"}q:after{content:"\201D"}del,s{text-decoration:line-through}blockquote{font-family:old standard tt,serif;text-align:center;padding:50px}blockquote p{display:inline-block;font-style:italic}blockquote:before,blockquote:after{font-family:old standard tt,serif;content:'\201C';font-size:35px;color:#403c3b}blockquote:after{content:'\201D'}hr{width:40%;height:1px;background:#403c3b;margin:25px auto}h1{font-size:35px}h2{font-size:28px}h3{font-size:22px;margin-top:18px}h1 a,h2 a,h3 a{text-decoration:none}h1,h2{margin-top:28px}#sub-header,.date{color:#403c3b;font-size:13px}#sub-header{margin:0 4px}#nav h1 a{font-size:35px;color:#1d1313;line-height:120%}.posts_listing a,#nav a{text-decoration:none}li{margin-left:20px}ul li{margin-left:5px}ul li{list-style-type:none}ul li:before{content:"\00BB \0020"}#nav ul li:before,.posts_listing li:before{content:'';margin-right:0}#content{text-align:left;width:100%;font-size:15px;padding:60px 0 80px}#content h1,#content h2{margin-bottom:5px}#content h2{font-size:25px}#content .entry-content{margin-top:15px}#content .date{margin-left:3px}#content h1{font-size:30px}.highlight{margin:10px 0}.posts_listing{margin:0 0 50px}.posts_listing li{margin:0 0 25px 15px}.posts_listing li a:hover,#nav a:hover{text-decoration:underline}#nav{text-align:center;position:static;margin-top:60px}#nav ul{display:table;margin:8px auto 0}#nav li{list-style-type:none;display:table-cell;font-size:15px;padding:0 20px}#links{display:flex;justify-content:space-between;margin:50px 0 0}#links :nth-child(1){margin-right:.5em}#links :nth-child(2){margin-left:.5em}#not-found{text-align:center}#not-found a{font-family:old standard tt,serif;font-size:200px;text-decoration:none;display:inline-block;padding-top:225px}@media(max-width:750px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:28px}#nav li{font-size:13px;padding:0 15px}#content{margin-top:0;padding-top:50px;font-size:14px}#content h1{font-size:25px}#content h2{font-size:22px}.posts_listing li div{font-size:12px}}@media(max-width:400px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:22px}#nav li{font-size:12px;padding:0 10px}#content{margin-top:0;padding-top:20px;font-size:12px}#content h1{font-size:20px}#content h2{font-size:18px}.posts_listing li div{font-size:12px}}@media(prefers-color-scheme:dark){*,#nav h1 a{color:#fdfdfd}body{background:#121212}pre,code{background-color:#262626}#sub-header,.date{color:#bababa}hr{background:#ebebeb}}</style></head><body><section id=nav><h1><a href=https://davidhampgonsalves.com/>David Hamp-Gonsalves</a></h1><ul><li><a href=//github.com/davidhampgonsalves>GitHub</a></li><li><a href=https://instagram.com/davidhampgonsalves/>Instagram</a></li><li><a href=https://davidhampgonsalves.com/projects/>Projects</a></li></ul></section><section id=content><h1>OpenCV/Python Color Tracking</h1><div id=sub-header>May 2011 Â· 3 minute read</div><div class=entry-content><p><img src=https://davidhampgonsalves.com/images/color_tracking.png alt></p><h2 id=preamble>Preamble</h2><p>I needed some color based object tracking for a project I was hacking together last weekend. I choose to use the OpenCV Python bindings since I knew that I wouldn&rsquo;t be doing anything fancy and I thought it would simplify the learning process. While the Python bindings are great I wasn&rsquo;t able to find much documentation and what I thought would be an easy 10 minutes turned into a bit of an afternoon project. Admittedly I got side tracked with CamShifts, Histograms, Moments and the example code.</p><p>I also found that most of the tutorials and documentation makes even simple concepts like color tracking seem more complex then it really are. This post is intended to help you bypass all that and help you get your feet wet teaching your computer to see.</p><h2 id=overview-of-the-process>Overview of the Process</h2><p>The first thing we need to do is to get a single frame of the video feed and convert its color model from RGB which OpenCV uses to represent images by default to HSV since we can then look at just a single value to determine the Hue.</p><p>Now that we have our image in the correct format we can apply a threshold to eliminate(set their value to 0) all pixels that don&rsquo;t meet our criteria. This will leave only the object we aim to track so then to determine its location we can get OpenCV to calculate its moments and compute its co-ordinal position.</p><h2 id=the-code>The Code</h2><p>And finally without further adieu, the commented code which will get you on your way. This code will open a window which will display the web cams video feed. It will then try to track a purple object but you can change the hue value to make it work with any color you want. Just make sure that color is fairly unique in the video feed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#! /usr/bin/env python</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>color_tracker_window <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Color Tracker&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ColorTracker</span>\:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self)\:
</span></span><span style=display:flex><span>        cv<span style=color:#f92672>.</span>NamedWindow( color_tracker_window, <span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>capture <span style=color:#f92672>=</span> cv<span style=color:#f92672>.</span>CaptureFromCAM(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run</span>(self)\:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>\:
</span></span><span style=display:flex><span>            img <span style=color:#f92672>=</span> cv<span style=color:#f92672>.</span>QueryFrame( self<span style=color:#f92672>.</span>capture )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#blur the source image to reduce color noise</span>
</span></span><span style=display:flex><span>            cv<span style=color:#f92672>.</span>Smooth(img, img, cv<span style=color:#f92672>.</span>CV_BLUR, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#convert the image to hsv(Hue, Saturation, Value) so its</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#easier to determine the color to track(hue)</span>
</span></span><span style=display:flex><span>            hsv_img <span style=color:#f92672>=</span> cv<span style=color:#f92672>.</span>CreateImage(cv<span style=color:#f92672>.</span>GetSize(img), <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>            cv<span style=color:#f92672>.</span>CvtColor(img, hsv_img, cv<span style=color:#f92672>.</span>CV_BGR2HSV)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#limit all pixels that don&#39;t match our criteria, in this case we are</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#looking for purple but if you want you can adjust the first value in</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#both turples which is the hue range(120,140).  OpenCV uses 0-180 as</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#a hue range for the HSV color model</span>
</span></span><span style=display:flex><span>            thresholded_img <span style=color:#f92672>=</span>  cv<span style=color:#f92672>.</span>CreateImage(cv<span style=color:#f92672>.</span>GetSize(hsv_img), <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>            cv<span style=color:#f92672>.</span>InRangeS(hsv_img, (<span style=color:#ae81ff>120</span>, <span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>80</span>), (<span style=color:#ae81ff>140</span>, <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>255</span>), thresholded_img)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#determine the objects moments and check that the area is large</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#enough to be our object</span>
</span></span><span style=display:flex><span>            moments <span style=color:#f92672>=</span> cv<span style=color:#f92672>.</span>Moments(thresholded_img, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            area <span style=color:#f92672>=</span> cv<span style=color:#f92672>.</span>GetCentralMoment(moments, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#there can be noise in the video so ignore objects with small areas</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span>(area <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>100000</span>)\:
</span></span><span style=display:flex><span>                <span style=color:#75715e>#determine the x and y coordinates of the center of the object</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>#we are tracking by dividing the 1, 0 and 0, 1 moments by the area</span>
</span></span><span style=display:flex><span>                x <span style=color:#f92672>=</span> cv<span style=color:#f92672>.</span>GetSpatialMoment(moments, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>)<span style=color:#f92672>/</span>area
</span></span><span style=display:flex><span>                y <span style=color:#f92672>=</span> cv<span style=color:#f92672>.</span>GetSpatialMoment(moments, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>/</span>area
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>#print &#39;x\: &#39; + str(x) + &#39; y\: &#39; + str(y) + &#39; area\: &#39; + str(area)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>#create an overlay to mark the center of the tracked object</span>
</span></span><span style=display:flex><span>                overlay <span style=color:#f92672>=</span> cv<span style=color:#f92672>.</span>CreateImage(cv<span style=color:#f92672>.</span>GetSize(img), <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                cv<span style=color:#f92672>.</span>Circle(overlay, (x, y), <span style=color:#ae81ff>2</span>, (<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>255</span>), <span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span>                cv<span style=color:#f92672>.</span>Add(img, overlay, img)
</span></span><span style=display:flex><span>                <span style=color:#75715e>#add the thresholded image back to the img so we can see what was</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>#left after it was applied</span>
</span></span><span style=display:flex><span>                cv<span style=color:#f92672>.</span>Merge(thresholded_img, <span style=color:#66d9ef>None</span>, <span style=color:#66d9ef>None</span>, <span style=color:#66d9ef>None</span>, img)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#display the image</span>
</span></span><span style=display:flex><span>            cv<span style=color:#f92672>.</span>ShowImage(color_tracker_window, img)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> cv<span style=color:#f92672>.</span>WaitKey(<span style=color:#ae81ff>10</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>27</span>\:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;__main__&#34;</span>\:
</span></span><span style=display:flex><span>    color_tracker <span style=color:#f92672>=</span> ColorTracker()
</span></span><span style=display:flex><span>    color_tracker<span style=color:#f92672>.</span>run()
</span></span></code></pre></div></div><div id=links><a href=https://davidhampgonsalves.com/pdfs-using-itext-in-10-lines/>&#171;&nbsp;PDF's using iText in 10 lines</a>
<a href=https://davidhampgonsalves.com/live-metadata-handling-using-osmf-3/3/>Live Metadata Handling Using OSMF (3/3)&nbsp;&#187;</a></div></section></body></html>