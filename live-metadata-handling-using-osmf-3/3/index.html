<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content><link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel=stylesheet media=print type=text/css onload='this.media="all"'><title>Live Metadata Handling Using OSMF (3/3)
</title><link rel=canonical href=https://davidhampgonsalves.com/live-metadata-handling-using-osmf-3/3/><style>*{border:0;font:inherit;font-size:100%;vertical-align:baseline;margin:0;padding:0;color:#000;text-decoration-skip:ink}body{font-family:open sans,myriad pro,Myriad,sans-serif;font-size:17px;line-height:160%;color:#1d1313;max-width:700px;margin:auto}p{margin:20px 0}a img{border:none}img{margin:10px auto;max-width:100%;display:block}.left-justify{float:left}.right-justify{float:right}pre,code{font:12px Consolas,liberation mono,Menlo,Courier,monospace;background-color:#f7f7f7}code{font-size:12px;padding:4px}pre{margin-top:0;margin-bottom:16px;word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45}pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}pre code{display:inline;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}pre code::before,pre code::after{content:normal}em,q,em,dfn{font-style:italic}.sans,html .gist .gist-file .gist-meta{font-family:open sans,myriad pro,Myriad,sans-serif}.mono,pre,code,tt,p code,li code{font-family:Menlo,Monaco,andale mono,lucida console,courier new,monospace}.heading,.serif,h1,h2,h3{font-family:old standard tt,serif}strong{font-weight:600}q:before{content:"\201C"}q:after{content:"\201D"}del,s{text-decoration:line-through}blockquote{font-family:old standard tt,serif;text-align:center;padding:50px}blockquote p{display:inline-block;font-style:italic}blockquote:before,blockquote:after{font-family:old standard tt,serif;content:'\201C';font-size:35px;color:#403c3b}blockquote:after{content:'\201D'}hr{width:40%;height:1px;background:#403c3b;margin:25px auto}h1{font-size:35px}h2{font-size:28px}h3{font-size:22px;margin-top:18px}h1 a,h2 a,h3 a{text-decoration:none}h1,h2{margin-top:28px}#sub-header,.date{color:#403c3b;font-size:13px}#sub-header{margin:0 4px}#nav h1 a{font-size:35px;color:#1d1313;line-height:120%}.posts_listing a,#nav a{text-decoration:none}li{margin-left:20px}ul li{margin-left:5px}ul li{list-style-type:none}ul li:before{content:"\00BB \0020"}#nav ul li:before,.posts_listing li:before{content:'';margin-right:0}#content{text-align:left;width:100%;font-size:15px;padding:60px 0 80px}#content h1,#content h2{margin-bottom:5px}#content h2{font-size:25px}#content .entry-content{margin-top:15px}#content .date{margin-left:3px}#content h1{font-size:30px}.highlight{margin:10px 0}.posts_listing{margin:0 0 50px}.posts_listing li{margin:0 0 25px 15px}.posts_listing li a:hover,#nav a:hover{text-decoration:underline}#nav{text-align:center;position:static;margin-top:60px}#nav ul{display:table;margin:8px auto 0}#nav li{list-style-type:none;display:table-cell;font-size:15px;padding:0 20px}#links{display:flex;justify-content:space-between;margin:50px 0 0}#links :nth-child(1){margin-right:.5em}#links :nth-child(2){margin-left:.5em}#not-found{text-align:center}#not-found a{font-family:old standard tt,serif;font-size:200px;text-decoration:none;display:inline-block;padding-top:225px}@media(max-width:750px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:28px}#nav li{font-size:13px;padding:0 15px}#content{margin-top:0;padding-top:50px;font-size:14px}#content h1{font-size:25px}#content h2{font-size:22px}.posts_listing li div{font-size:12px}}@media(max-width:400px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:22px}#nav li{font-size:12px;padding:0 10px}#content{margin-top:0;padding-top:20px;font-size:12px}#content h1{font-size:20px}#content h2{font-size:18px}.posts_listing li div{font-size:12px}}@media(prefers-color-scheme:dark){*,#nav h1 a{color:#fdfdfd}body{background:#121212}pre,code{background-color:#262626}#sub-header,.date{color:#bababa}hr{background:#ebebeb}}</style></head><body><section id=nav><h1><a class=h-card href=https://davidhampgonsalves.com/>David Hamp-Gonsalves</a></h1><ul><li><a href=//github.com/davidhampgonsalves>GitHub</a></li><li><a href=https://instagram.com/davidhampgonsalves/>Instagram</a></li><li><a href=https://davidhampgonsalves.com/projects>Projects</a></li><li><a href=https://davidhampgonsalves.com/resume>Resume</a></li></ul></section><section id=content><h1>Live Metadata Handling Using OSMF (3/3)</h1><div id=sub-header>August 2011 Â· 3 minute read</div><div class=entry-content><p>This is the third post in a series about injecting JSON based metadata into a live RTP streams using Wowza Media Server, Adobe Flex and OSMF.</p><h2 id=what-weve-built>What We&rsquo;ve Built</h2><p>So far in the previous posts(1,2) we setup Wowza and created a module which will inject our JSON metadata into our live RTP stream. Then we created a flash object to trigger the event injection with our metadata from the browser.</p><h2 id=what-were-building-in-this-post>What We&rsquo;re Building (in this post)</h2><p>In this post we&rsquo;ll be reacting to the metadata event to preform related actions on the streaming clients browser. We&rsquo;ll keep the flash to a minimum by converting the metadata action script object to JSON and passing it off to our javascript handler. In this way we can add or modify the reactions associated with the metadata without having to rebuild or modify our player.</p><h2 id=working-with-osmf>Working with OSMF</h2><p>Since by now you should already have flash builder installed you&rsquo;ll now just need to get the OSMF libraries from osmf.org. At the time of writing I was using version 1.5.</p><p>Once you have the library you just need to add the OSMF.swc to your projects build path. This is done by right clicking your project and selecting &ldquo;properties&rdquo;. Then select &ldquo;build path&rdquo; and add the library.</p><p>Depending if you want to convert your data to JSON and pass it off to some javascript you can also grab the as3corelib which will help with the Action Script object to JSON conversion.</p><h2 id=adding-metadata-handling-to-osmfs-lightweightvideoelement>Adding Metadata Handling to OSMF&rsquo;s LightweightVideoElement</h2><p>To handle our event we need to use OSMF NetClient. Our players NetClient wont be ready until the player is ready to play so we set up our handler by overriding the processReadyState method.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-actionscript data-lang=actionscript><span style=display:flex><span><span style=color:#66d9ef>override</span> <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>processReadyState</span>()<span style=color:#f92672>\:</span><span style=color:#a6e22e>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>processReadyState</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>addHandler</span>(<span style=color:#e6db74>&#34;question&#34;</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>onMetaData</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>That&rsquo;s really the only change we need to make. Our onMetadata will be called when metadata is received and because its embedded in the media stream it will be in sync.</p><p>To actually do something with the metadata you can convert it to JSON like bellow and call an external javascript function of your choosing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>onMetadata</span>(<span style=color:#a6e22e>data</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:</span>Object)<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:</span><span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>//convert the question to json and call javascript handler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>dataToJSON</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:</span>Object <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Object();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dataToJSON</span>.<span style=color:#a6e22e>text</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>text</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dataToJSON</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>type</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dataToJSON</span>.<span style=color:#a6e22e>duration</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>duration</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dataToJSON</span>.<span style=color:#a6e22e>attributes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>attributes</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>dataJSON</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>:</span>String <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>encode</span>(<span style=color:#a6e22e>dataToJSON</span>);
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ExternalInterface</span>.<span style=color:#a6e22e>call</span>(<span style=color:#e6db74>&#34;onData&#34;</span>, <span style=color:#a6e22e>dataJSON</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=closing>Closing</h2><p>Over these last three posts we&rsquo;ve build a system that allows us to stream a live event and in (near) real time inject data of our choosing which will then be injected into our RTP stream by Wowza and be displayed in the users browser.</p><p>This is a pretty useful technique and so far I&rsquo;ve only see it used to trigger next slide events in presentation software. The sky is the limit with this one I think.</p><h2 id=code-finally>Code (finally)</h2><p>The code is safely tucked away in <a href=https://github.com/davidhampgonsalves/Wowza-Metadata-Injection-Demo>github</a>.</p></div><div id=links><a href=https://davidhampgonsalves.com/opencv/python-color-tracking/>&#171;&nbsp;OpenCV/Python Color Tracking</a>
<a href=https://davidhampgonsalves.com/flash-netconnection-for-wowza-rmi-2/3/>Flash NetConnection for Wowza RMI (2/3)&nbsp;&#187;</a></div></section></body></html>